<!DOCTYPE html>
<html lang="en">
<head>
    <title>BOOKING APP</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <form onsubmit="saveToLocalStorage(event)">
        <h1 class="heading">Book a call</h1>
        <p class="ans">Book a call slot and our representative will call you within 1hr of selected time</p>
        <hr>
        <label>Name:</label><br>
        <input id = 'username' type="text" name="username" required/><br>
        <label>Email:</label><br>
        <input id = 'email' type="email" name="emailId" required/><br>
        <label>Phone:</label><br>
        <input id= 'phonenumber' type="tel" name="phonenumber" required/>
        <label>Time for call:</label><br>
          <input id='calldate' type="date" name="calldate" value="" style="width:290px;">
          <input id="calltime" type="time" name="calltime" value="" style="width:280px;";><br><br>
          <button class="btn">Get a call</button>
    </form> 
    <ul id = 'listOfUsers' class="listuser"></ul>  
    <script>
        function saveToLocalStorage(event) {
           event.preventDefault();
           const name = event.target.username.value;
           const email = event.target.emailId.value;
           const phonenumber = event.target.phonenumber.value;
           const calldate = event.target.calldate.value;
           const calltime = event.target.calltime.value;

           const obj = {
               name,
               email,
               phonenumber,
               calldate,
               calltime
           }
           localStorage.setItem(obj.email, JSON.stringify(obj))
           showNewUserOnScreen(obj)
       }

       window.addEventListener("DOMContentLoaded", () => {
           const localStorageObj = localStorage;
           const localstoragekeys  = Object.keys(localStorageObj)

           for(var i =0; i< localstoragekeys.length; i++){
               const key = localstoragekeys[i]
               const userDetailsString = localStorageObj[key];
               const userDetailsObj = JSON.parse(userDetailsString);
               showNewUserOnScreen(userDetailsObj)
           }
       })

       function showNewUserOnScreen(user){
           document.getElementById('email').value = '';
           document.getElementById('username').value = '';
           document.getElementById('phonenumber').value ='';
           document.getElementById('calldate').value ='';
           document.getElementById('calltime').value ='';


           const parentNode = document.getElementById('listOfUsers');
           const childHTML = `<li id=${user.email}> ${user.name} - ${user.email}
                                   <button class='deletbutton' onclick=deleteUser('${user.email}')> Delete User </button>
                                   <button class='editbutton' onclick=editUserDetails('${user.email}','${user.name}','${user.phonenumber}','${user.calldate}','${user.calltime}')>Edit User </button>
                                </li>`

           parentNode.innerHTML = parentNode.innerHTML + childHTML;
       }
       // Edit user details
       function editUserDetails(emailId, name, phonenumber,calldate,calltime){
           document.getElementById('email').value = emailId;
           document.getElementById('username').value = name;
           document.getElementById('phonenumber').value =phonenumber;
           document.getElementById('calldate').value = name;
           document.getElementById('calltime').value =phonenumber;

           deleteUser(emailId);


       }

       // deleteUser('abc@gmail.com')

       function deleteUser(emailId){
           console.log(emailId)
           localStorage.removeItem(emailId);
           removeUserFromScreen(emailId);

       }

       function removeUserFromScreen(emailId){
           const parentNode = document.getElementById('listOfUsers');
           const childNodeToBeDeleted = document.getElementById(emailId);

           parentNode.removeChild(childNodeToBeDeleted)
       }

   </script>  
    </div>
</body>
</html>